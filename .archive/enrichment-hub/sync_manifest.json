{
  "version": "1.0.0",
  "manifest_id": "enricha-vision-barton-sync",
  "created_at": "2025-11-07T00:00:00Z",
  "description": "Sync manifest for Neon → Supabase → Neon enrichment pipeline between barton-outreach-core and enricha-vision",
  "project": {
    "ctb_id": "4.svg.marketing.enricha-vision",
    "source_repo": "https://github.com/djb258/barton-outreach-core.git",
    "enrichment_hub_repo": "enricha-vision"
  },

  "databases": {
    "source_neon": {
      "type": "neon-postgres",
      "host_env": "DATABASE_URL",
      "description": "Barton Outreach Core production database (Neon)",
      "ssl": "require",
      "schemas": ["public", "marketing"]
    },
    "enrichment_supabase": {
      "type": "supabase-postgres",
      "host_env": "SUPABASE_DB_URL",
      "description": "Enrichment Hub workspace (Supabase)",
      "ssl": "require",
      "schemas": ["public"]
    },
    "audit_neon": {
      "type": "neon-postgres",
      "host_env": "AUDIT_DB_URL",
      "description": "Audit and validation logs (Neon)",
      "ssl": "require",
      "schemas": ["shq"]
    }
  },

  "workflow_stages": {
    "stage_1_pull_invalid": {
      "name": "Pull Invalid Records",
      "direction": "neon → supabase",
      "trigger": "scheduled_30min",
      "description": "Pull failed/pending validation records from Neon to Supabase for enrichment",
      "n8n_workflow": "pull_from_external_source.json",
      "script": "scripts/01_pull_invalid_to_supabase.py"
    },
    "stage_2_manual_enrichment": {
      "name": "Manual Enrichment",
      "direction": "supabase (manual)",
      "trigger": "manual",
      "description": "Human review and data enrichment in Supabase workspace",
      "interface": "supabase_dashboard",
      "script": null
    },
    "stage_3_push_enriched": {
      "name": "Push Enriched Data",
      "direction": "supabase → neon",
      "trigger": "manual_or_scheduled",
      "description": "Push validated enriched records back to Neon",
      "n8n_workflow": "pull_from_enrichment_hub.json",
      "script": "scripts/02_push_enriched_to_neon.py"
    },
    "stage_4_cleanup": {
      "name": "Cleanup & Archive",
      "direction": "supabase (cleanup)",
      "trigger": "scheduled_daily",
      "description": "Archive or delete processed records from Supabase",
      "n8n_workflow": "pull_from_enrichment_hub.json (cleanup nodes)",
      "script": "scripts/03_cleanup_supabase.py"
    }
  },

  "entity_types": {
    "company": {
      "neon_table": "marketing.company_invalid",
      "supabase_table": "public.company_needs_enrichment",
      "primary_key": "id",
      "unique_field": "domain",
      "record_count_pending": 119,
      "common_issues": [
        "missing_website",
        "invalid_domain",
        "incomplete_contact_info",
        "missing_industry"
      ]
    },
    "people": {
      "neon_table": "marketing.people_invalid",
      "supabase_table": "public.people_needs_enrichment",
      "primary_key": "id",
      "unique_field": "email",
      "record_count_pending": 5,
      "common_issues": [
        "missing_email",
        "invalid_phone",
        "missing_title",
        "incomplete_name"
      ]
    }
  },

  "schemas": {
    "neon_company_invalid": {
      "table": "marketing.company_invalid",
      "description": "Invalid company records from Barton Outreach Core",
      "fields": [
        {"name": "id", "type": "SERIAL PRIMARY KEY", "required": true, "description": "Auto-incrementing primary key"},
        {"name": "company_name", "type": "TEXT", "required": true, "description": "Company name"},
        {"name": "domain", "type": "TEXT", "required": false, "description": "Company website domain (often missing)"},
        {"name": "industry", "type": "TEXT", "required": false, "description": "Industry classification"},
        {"name": "employee_count", "type": "INTEGER", "required": false, "description": "Number of employees"},
        {"name": "revenue", "type": "NUMERIC", "required": false, "description": "Annual revenue"},
        {"name": "location", "type": "TEXT", "required": false, "description": "Company location"},
        {"name": "linkedin_url", "type": "TEXT", "required": false, "description": "LinkedIn company URL"},
        {"name": "enrichment_data", "type": "JSONB", "required": false, "description": "Additional enrichment metadata"},
        {"name": "validation_status", "type": "TEXT", "required": true, "description": "FAILED, PENDING, READY"},
        {"name": "validation_errors", "type": "TEXT[]", "required": false, "description": "Array of validation error messages"},
        {"name": "promoted_to", "type": "TEXT", "required": false, "description": "Where record was promoted (e.g., 'enrichment-hub')"},
        {"name": "promoted_at", "type": "TIMESTAMP", "required": false, "description": "When record was promoted"},
        {"name": "created_at", "type": "TIMESTAMP", "required": true, "description": "Record creation timestamp"},
        {"name": "updated_at", "type": "TIMESTAMP", "required": true, "description": "Last update timestamp"}
      ],
      "indexes": [
        {"name": "idx_company_invalid_status", "fields": ["validation_status"]},
        {"name": "idx_company_invalid_promoted", "fields": ["promoted_to", "promoted_at"]},
        {"name": "idx_company_invalid_domain", "fields": ["domain"]}
      ]
    },

    "neon_people_invalid": {
      "table": "marketing.people_invalid",
      "description": "Invalid people records from Barton Outreach Core",
      "fields": [
        {"name": "id", "type": "SERIAL PRIMARY KEY", "required": true, "description": "Auto-incrementing primary key"},
        {"name": "first_name", "type": "TEXT", "required": false, "description": "First name"},
        {"name": "last_name", "type": "TEXT", "required": false, "description": "Last name"},
        {"name": "email", "type": "TEXT", "required": false, "description": "Email address (often missing)"},
        {"name": "phone", "type": "TEXT", "required": false, "description": "Phone number"},
        {"name": "title", "type": "TEXT", "required": false, "description": "Job title"},
        {"name": "company_id", "type": "INTEGER", "required": false, "description": "Foreign key to company table"},
        {"name": "company_name", "type": "TEXT", "required": false, "description": "Company name (denormalized)"},
        {"name": "linkedin_url", "type": "TEXT", "required": false, "description": "LinkedIn profile URL"},
        {"name": "enrichment_data", "type": "JSONB", "required": false, "description": "Additional enrichment metadata"},
        {"name": "validation_status", "type": "TEXT", "required": true, "description": "FAILED, PENDING, READY"},
        {"name": "validation_errors", "type": "TEXT[]", "required": false, "description": "Array of validation error messages"},
        {"name": "promoted_to", "type": "TEXT", "required": false, "description": "Where record was promoted"},
        {"name": "promoted_at", "type": "TIMESTAMP", "required": false, "description": "When record was promoted"},
        {"name": "created_at", "type": "TIMESTAMP", "required": true, "description": "Record creation timestamp"},
        {"name": "updated_at", "type": "TIMESTAMP", "required": true, "description": "Last update timestamp"}
      ],
      "indexes": [
        {"name": "idx_people_invalid_status", "fields": ["validation_status"]},
        {"name": "idx_people_invalid_promoted", "fields": ["promoted_to", "promoted_at"]},
        {"name": "idx_people_invalid_email", "fields": ["email"]}
      ]
    },

    "supabase_company_enrichment": {
      "table": "public.company_needs_enrichment",
      "description": "Companies awaiting enrichment in Enrichment Hub",
      "fields": [
        {"name": "id", "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()", "required": true, "description": "UUID primary key"},
        {"name": "company_name", "type": "TEXT", "required": true, "description": "Company name"},
        {"name": "domain", "type": "TEXT", "required": false, "description": "Company website domain"},
        {"name": "industry", "type": "TEXT", "required": false, "description": "Industry classification"},
        {"name": "employee_count", "type": "INTEGER", "required": false, "description": "Number of employees"},
        {"name": "revenue", "type": "NUMERIC", "required": false, "description": "Annual revenue"},
        {"name": "location", "type": "TEXT", "required": false, "description": "Company location"},
        {"name": "linkedin_url", "type": "TEXT", "required": false, "description": "LinkedIn company URL"},
        {"name": "enrichment_data", "type": "JSONB", "required": false, "description": "Enrichment metadata"},
        {"name": "validation_status", "type": "TEXT", "required": true, "description": "PENDING, IN_REVIEW, READY, PASSED"},
        {"name": "source_repo", "type": "TEXT", "required": true, "description": "Source repository identifier"},
        {"name": "source_id", "type": "TEXT", "required": true, "description": "Original source record ID"},
        {"name": "source_table", "type": "TEXT", "required": true, "description": "Source table name"},
        {"name": "source_environment", "type": "TEXT", "required": false, "description": "Source environment (dev/staging/prod)"},
        {"name": "batch_id", "type": "TEXT", "required": true, "description": "Import batch identifier"},
        {"name": "entity_type", "type": "TEXT", "required": true, "description": "'company'"},
        {"name": "state_code", "type": "TEXT", "required": false, "description": "State or region code"},
        {"name": "priority", "type": "TEXT", "required": false, "description": "low, medium, high"},
        {"name": "needs_review", "type": "BOOLEAN", "required": false, "description": "Flags for manual review"},
        {"name": "enrichment_source", "type": "TEXT", "required": false, "description": "external-import, apollo, clay, etc."},
        {"name": "pulled_at", "type": "TIMESTAMP", "required": false, "description": "When pulled from source"},
        {"name": "imported_at", "type": "TIMESTAMP", "required": false, "description": "When imported to Supabase"},
        {"name": "enriched_at", "type": "TIMESTAMP", "required": false, "description": "When enrichment completed"},
        {"name": "enriched_by", "type": "TEXT", "required": false, "description": "User or system that enriched"},
        {"name": "promoted_at", "type": "TIMESTAMP", "required": false, "description": "When promoted back to Neon"},
        {"name": "promoted_to_neon", "type": "BOOLEAN", "required": false, "description": "Has been promoted back"},
        {"name": "created_at", "type": "TIMESTAMP DEFAULT NOW()", "required": true, "description": "Record creation"},
        {"name": "updated_at", "type": "TIMESTAMP DEFAULT NOW()", "required": true, "description": "Last update"}
      ],
      "indexes": [
        {"name": "idx_company_enrichment_status", "fields": ["validation_status"]},
        {"name": "idx_company_enrichment_batch", "fields": ["batch_id"]},
        {"name": "idx_company_enrichment_source", "fields": ["source_repo", "source_id"]},
        {"name": "idx_company_enrichment_domain", "fields": ["domain"]}
      ]
    },

    "supabase_people_enrichment": {
      "table": "public.people_needs_enrichment",
      "description": "People awaiting enrichment in Enrichment Hub",
      "fields": [
        {"name": "id", "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()", "required": true, "description": "UUID primary key"},
        {"name": "first_name", "type": "TEXT", "required": false, "description": "First name"},
        {"name": "last_name", "type": "TEXT", "required": false, "description": "Last name"},
        {"name": "email", "type": "TEXT", "required": false, "description": "Email address"},
        {"name": "phone", "type": "TEXT", "required": false, "description": "Phone number"},
        {"name": "title", "type": "TEXT", "required": false, "description": "Job title"},
        {"name": "company_id", "type": "UUID", "required": false, "description": "Foreign key to company table"},
        {"name": "company_name", "type": "TEXT", "required": false, "description": "Company name"},
        {"name": "linkedin_url", "type": "TEXT", "required": false, "description": "LinkedIn profile URL"},
        {"name": "enrichment_data", "type": "JSONB", "required": false, "description": "Enrichment metadata"},
        {"name": "validation_status", "type": "TEXT", "required": true, "description": "PENDING, IN_REVIEW, READY, PASSED"},
        {"name": "source_repo", "type": "TEXT", "required": true, "description": "Source repository identifier"},
        {"name": "source_id", "type": "TEXT", "required": true, "description": "Original source record ID"},
        {"name": "source_table", "type": "TEXT", "required": true, "description": "Source table name"},
        {"name": "source_environment", "type": "TEXT", "required": false, "description": "Source environment"},
        {"name": "batch_id", "type": "TEXT", "required": true, "description": "Import batch identifier"},
        {"name": "entity_type", "type": "TEXT", "required": true, "description": "'people'"},
        {"name": "state_code", "type": "TEXT", "required": false, "description": "State or region code"},
        {"name": "priority", "type": "TEXT", "required": false, "description": "low, medium, high"},
        {"name": "needs_review", "type": "BOOLEAN", "required": false, "description": "Flags for manual review"},
        {"name": "enrichment_source", "type": "TEXT", "required": false, "description": "external-import, apollo, clay, etc."},
        {"name": "pulled_at", "type": "TIMESTAMP", "required": false, "description": "When pulled from source"},
        {"name": "imported_at", "type": "TIMESTAMP", "required": false, "description": "When imported to Supabase"},
        {"name": "enriched_at", "type": "TIMESTAMP", "required": false, "description": "When enrichment completed"},
        {"name": "enriched_by", "type": "TEXT", "required": false, "description": "User or system that enriched"},
        {"name": "promoted_at", "type": "TIMESTAMP", "required": false, "description": "When promoted back to Neon"},
        {"name": "promoted_to_neon", "type": "BOOLEAN", "required": false, "description": "Has been promoted back"},
        {"name": "created_at", "type": "TIMESTAMP DEFAULT NOW()", "required": true, "description": "Record creation"},
        {"name": "updated_at", "type": "TIMESTAMP DEFAULT NOW()", "required": true, "description": "Last update"}
      ],
      "indexes": [
        {"name": "idx_people_enrichment_status", "fields": ["validation_status"]},
        {"name": "idx_people_enrichment_batch", "fields": ["batch_id"]},
        {"name": "idx_people_enrichment_source", "fields": ["source_repo", "source_id"]},
        {"name": "idx_people_enrichment_email", "fields": ["email"]}
      ]
    },

    "audit_log": {
      "table": "shq.audit_log",
      "description": "Audit trail for all sync operations",
      "fields": [
        {"name": "id", "type": "SERIAL PRIMARY KEY", "required": true, "description": "Auto-incrementing primary key"},
        {"name": "workflow_name", "type": "TEXT", "required": true, "description": "Name of workflow that generated log"},
        {"name": "entity_type", "type": "TEXT", "required": true, "description": "company, people, etc."},
        {"name": "action", "type": "TEXT", "required": true, "description": "import, export, update, delete"},
        {"name": "record_count", "type": "INTEGER", "required": true, "description": "Number of records affected"},
        {"name": "status", "type": "TEXT", "required": true, "description": "success, failed, partial"},
        {"name": "batch_id", "type": "TEXT", "required": false, "description": "Batch identifier"},
        {"name": "source_repo", "type": "TEXT", "required": false, "description": "Source repository"},
        {"name": "source_table", "type": "TEXT", "required": false, "description": "Source table"},
        {"name": "destination_table", "type": "TEXT", "required": false, "description": "Destination table"},
        {"name": "timestamp", "type": "TIMESTAMP DEFAULT NOW()", "required": true, "description": "Log timestamp"},
        {"name": "metadata", "type": "JSONB", "required": false, "description": "Additional metadata"}
      ],
      "indexes": [
        {"name": "idx_audit_log_workflow", "fields": ["workflow_name", "timestamp"]},
        {"name": "idx_audit_log_batch", "fields": ["batch_id"]},
        {"name": "idx_audit_log_status", "fields": ["status", "timestamp"]}
      ]
    }
  },

  "field_mappings": {
    "company_neon_to_supabase": {
      "description": "Field mapping when pulling from Neon to Supabase",
      "mappings": [
        {"source": "id", "destination": "source_id", "transform": "to_string"},
        {"source": "company_name", "destination": "company_name", "transform": "direct"},
        {"source": "domain", "destination": "domain", "transform": "direct"},
        {"source": "industry", "destination": "industry", "transform": "direct"},
        {"source": "employee_count", "destination": "employee_count", "transform": "direct"},
        {"source": "revenue", "destination": "revenue", "transform": "direct"},
        {"source": "location", "destination": "location", "transform": "direct"},
        {"source": "linkedin_url", "destination": "linkedin_url", "transform": "direct"},
        {"source": "enrichment_data", "destination": "enrichment_data", "transform": "direct"},
        {"source": "validation_status", "destination": "validation_status", "transform": "map_to_pending"},
        {"source": null, "destination": "source_repo", "transform": "constant:barton-outreach-core"},
        {"source": null, "destination": "source_table", "transform": "constant:marketing.company_invalid"},
        {"source": null, "destination": "entity_type", "transform": "constant:company"},
        {"source": null, "destination": "batch_id", "transform": "generate_batch_id"},
        {"source": null, "destination": "priority", "transform": "constant:medium"},
        {"source": null, "destination": "needs_review", "transform": "constant:true"},
        {"source": null, "destination": "enrichment_source", "transform": "constant:external-import"}
      ]
    },

    "company_supabase_to_neon": {
      "description": "Field mapping when pushing enriched data back to Neon",
      "push_back_fields": [
        "domain",
        "industry",
        "employee_count",
        "revenue",
        "location",
        "linkedin_url",
        "enrichment_data"
      ],
      "mappings": [
        {"source": "domain", "destination": "domain", "transform": "direct", "required": true},
        {"source": "industry", "destination": "industry", "transform": "direct", "required": false},
        {"source": "employee_count", "destination": "employee_count", "transform": "direct", "required": false},
        {"source": "revenue", "destination": "revenue", "transform": "direct", "required": false},
        {"source": "location", "destination": "location", "transform": "direct", "required": false},
        {"source": "linkedin_url", "destination": "linkedin_url", "transform": "direct", "required": false},
        {"source": "enrichment_data", "destination": "enrichment_data", "transform": "merge_jsonb", "required": false},
        {"source": null, "destination": "validation_status", "transform": "constant:READY", "required": true},
        {"source": null, "destination": "promoted_to", "transform": "constant:marketing.company_master", "required": false},
        {"source": null, "destination": "promoted_at", "transform": "now", "required": false}
      ]
    },

    "people_neon_to_supabase": {
      "description": "Field mapping when pulling from Neon to Supabase",
      "mappings": [
        {"source": "id", "destination": "source_id", "transform": "to_string"},
        {"source": "first_name", "destination": "first_name", "transform": "direct"},
        {"source": "last_name", "destination": "last_name", "transform": "direct"},
        {"source": "email", "destination": "email", "transform": "direct"},
        {"source": "phone", "destination": "phone", "transform": "direct"},
        {"source": "title", "destination": "title", "transform": "direct"},
        {"source": "company_id", "destination": "company_id", "transform": "lookup_or_null"},
        {"source": "company_name", "destination": "company_name", "transform": "direct"},
        {"source": "linkedin_url", "destination": "linkedin_url", "transform": "direct"},
        {"source": "enrichment_data", "destination": "enrichment_data", "transform": "direct"},
        {"source": "validation_status", "destination": "validation_status", "transform": "map_to_pending"},
        {"source": null, "destination": "source_repo", "transform": "constant:barton-outreach-core"},
        {"source": null, "destination": "source_table", "transform": "constant:marketing.people_invalid"},
        {"source": null, "destination": "entity_type", "transform": "constant:people"},
        {"source": null, "destination": "batch_id", "transform": "generate_batch_id"},
        {"source": null, "destination": "priority", "transform": "constant:medium"},
        {"source": null, "destination": "needs_review", "transform": "constant:true"},
        {"source": null, "destination": "enrichment_source", "transform": "constant:external-import"}
      ]
    },

    "people_supabase_to_neon": {
      "description": "Field mapping when pushing enriched data back to Neon",
      "push_back_fields": [
        "email",
        "phone",
        "title",
        "linkedin_url",
        "enrichment_data"
      ],
      "mappings": [
        {"source": "email", "destination": "email", "transform": "direct", "required": true},
        {"source": "phone", "destination": "phone", "transform": "direct", "required": false},
        {"source": "title", "destination": "title", "transform": "direct", "required": false},
        {"source": "linkedin_url", "destination": "linkedin_url", "transform": "direct", "required": false},
        {"source": "enrichment_data", "destination": "enrichment_data", "transform": "merge_jsonb", "required": false},
        {"source": null, "destination": "validation_status", "transform": "constant:READY", "required": true},
        {"source": null, "destination": "promoted_to", "transform": "constant:marketing.people_master", "required": false},
        {"source": null, "destination": "promoted_at", "transform": "now", "required": false}
      ]
    }
  },

  "validation_rules": {
    "company": {
      "required_for_ready": ["company_name", "domain"],
      "recommended_for_ready": ["industry", "location", "linkedin_url"],
      "quality_checks": [
        {"field": "domain", "rule": "valid_url", "error": "Invalid domain format"},
        {"field": "domain", "rule": "not_empty", "error": "Domain cannot be empty"},
        {"field": "linkedin_url", "rule": "starts_with_linkedin", "error": "Invalid LinkedIn URL"},
        {"field": "employee_count", "rule": "positive_integer", "error": "Employee count must be positive"},
        {"field": "revenue", "rule": "positive_number", "error": "Revenue must be positive"}
      ],
      "auto_fix_rules": [
        {"field": "domain", "rule": "normalize_url", "action": "Remove http://, https://, www."},
        {"field": "company_name", "rule": "trim_whitespace", "action": "Trim leading/trailing spaces"},
        {"field": "linkedin_url", "rule": "normalize_linkedin", "action": "Standardize LinkedIn URL format"}
      ]
    },
    "people": {
      "required_for_ready": ["first_name", "last_name", "email"],
      "recommended_for_ready": ["title", "company_name", "linkedin_url"],
      "quality_checks": [
        {"field": "email", "rule": "valid_email", "error": "Invalid email format"},
        {"field": "email", "rule": "not_empty", "error": "Email cannot be empty"},
        {"field": "phone", "rule": "valid_phone", "error": "Invalid phone format"},
        {"field": "linkedin_url", "rule": "starts_with_linkedin", "error": "Invalid LinkedIn URL"}
      ],
      "auto_fix_rules": [
        {"field": "email", "rule": "lowercase", "action": "Convert to lowercase"},
        {"field": "email", "rule": "trim_whitespace", "action": "Trim spaces"},
        {"field": "phone", "rule": "normalize_phone", "action": "Format phone number"},
        {"field": "first_name", "rule": "capitalize", "action": "Capitalize first letter"},
        {"field": "last_name", "rule": "capitalize", "action": "Capitalize first letter"}
      ]
    }
  },

  "sync_queries": {
    "pull_invalid_companies": {
      "description": "Pull invalid company records from Neon to Supabase",
      "database": "source_neon",
      "query": "SELECT * FROM marketing.company_invalid WHERE promoted_to IS NULL AND validation_status IN ('FAILED', 'PENDING') ORDER BY created_at ASC LIMIT $1",
      "params": ["batch_size"],
      "destination": "enrichment_supabase.public.company_needs_enrichment"
    },
    "pull_invalid_people": {
      "description": "Pull invalid people records from Neon to Supabase",
      "database": "source_neon",
      "query": "SELECT * FROM marketing.people_invalid WHERE promoted_to IS NULL AND validation_status IN ('FAILED', 'PENDING') ORDER BY created_at ASC LIMIT $1",
      "params": ["batch_size"],
      "destination": "enrichment_supabase.public.people_needs_enrichment"
    },
    "push_enriched_companies": {
      "description": "Push enriched company records back to Neon",
      "database": "enrichment_supabase",
      "query": "SELECT * FROM public.company_needs_enrichment WHERE validation_status = 'READY' AND promoted_to_neon = FALSE ORDER BY enriched_at ASC",
      "destination": "source_neon.marketing.company_master"
    },
    "push_enriched_people": {
      "description": "Push enriched people records back to Neon",
      "database": "enrichment_supabase",
      "query": "SELECT * FROM public.people_needs_enrichment WHERE validation_status = 'READY' AND promoted_to_neon = FALSE ORDER BY enriched_at ASC",
      "destination": "source_neon.marketing.people_master"
    },
    "update_source_promoted": {
      "description": "Mark source records as promoted",
      "database": "source_neon",
      "query": "UPDATE marketing.company_invalid SET promoted_to = 'enrichment-hub', promoted_at = NOW() WHERE id = ANY($1)",
      "params": ["record_ids"]
    },
    "cleanup_processed": {
      "description": "Clean up processed records from Supabase",
      "database": "enrichment_supabase",
      "query": "DELETE FROM public.company_needs_enrichment WHERE validation_status = 'PASSED' AND promoted_at < NOW() - INTERVAL '7 days'",
      "params": []
    }
  },

  "configuration": {
    "batch_size": 1000,
    "sync_interval_minutes": 30,
    "cleanup_retention_days": 7,
    "auto_update_source": true,
    "enable_audit_logging": true,
    "notification_webhooks": {
      "slack": "${SLACK_WEBHOOK_URL}",
      "discord": "${DISCORD_WEBHOOK_URL}"
    }
  },

  "scripts": {
    "01_pull_invalid_to_supabase": {
      "language": "python",
      "description": "Pull invalid records from Neon to Supabase",
      "entry_point": "scripts/01_pull_invalid_to_supabase.py",
      "dependencies": ["psycopg2", "python-dotenv"],
      "environment_vars": ["DATABASE_URL", "SUPABASE_DB_URL", "BATCH_SIZE"]
    },
    "02_push_enriched_to_neon": {
      "language": "python",
      "description": "Push enriched records from Supabase back to Neon",
      "entry_point": "scripts/02_push_enriched_to_neon.py",
      "dependencies": ["psycopg2", "python-dotenv"],
      "environment_vars": ["DATABASE_URL", "SUPABASE_DB_URL"]
    },
    "03_cleanup_supabase": {
      "language": "python",
      "description": "Clean up processed records from Supabase",
      "entry_point": "scripts/03_cleanup_supabase.py",
      "dependencies": ["psycopg2", "python-dotenv"],
      "environment_vars": ["SUPABASE_DB_URL", "RETENTION_DAYS"]
    },
    "04_validate_enrichment": {
      "language": "python",
      "description": "Validate enriched records before promotion",
      "entry_point": "scripts/04_validate_enrichment.py",
      "dependencies": ["psycopg2", "python-dotenv", "validators"],
      "environment_vars": ["SUPABASE_DB_URL"]
    }
  },

  "n8n_workflows": {
    "pull_from_external_source": {
      "file": "n8n/pull_from_external_source.json",
      "description": "Universal receiver - pulls from any Neon/Postgres to Supabase",
      "trigger": "scheduled_30min",
      "credentials_required": ["External Source PostgreSQL", "Supabase PostgreSQL", "Neon Audit PostgreSQL"]
    },
    "pull_from_enrichment_hub": {
      "file": "n8n/pull_from_enrichment_hub.json",
      "description": "Promotes validated records from Supabase to Neon production",
      "trigger": "scheduled_daily_2am",
      "credentials_required": ["Supabase PostgreSQL", "Neon PostgreSQL"]
    }
  },

  "usage": {
    "setup": [
      "1. Clone or reference this repo from barton-outreach-core",
      "2. Create Supabase tables using schemas from this manifest",
      "3. Configure environment variables (DATABASE_URL, SUPABASE_DB_URL)",
      "4. Import n8n workflows or run Python scripts",
      "5. Test with manual execution before scheduling"
    ],
    "example_python": {
      "description": "Example code to read this manifest",
      "code": "import json\nwith open('sync_manifest.json', 'r') as f:\n    manifest = json.load(f)\n    \n# Get company schema\ncompany_schema = manifest['schemas']['supabase_company_enrichment']\nfor field in company_schema['fields']:\n    print(f\"{field['name']}: {field['type']}\")\n    \n# Get pull query\npull_query = manifest['sync_queries']['pull_invalid_companies']['query']\nprint(pull_query)"
    }
  },

  "metadata": {
    "total_invalid_records": 124,
    "companies": 119,
    "people": 5,
    "last_updated": "2025-11-07T00:00:00Z",
    "schema_version": "1.0.0",
    "compatible_with": ["n8n >= 1.0", "python >= 3.8", "postgres >= 14"]
  }
}
