# ============================================
# Source Bridge Configuration
# External Neon/Postgres Database Connection
# ============================================
#
# This file configures the external source database that contains
# failed or pending validation records to be pulled into Enrichment Hub.
#
# Usage:
#   1. Copy this file and remove .example suffix
#   2. Fill in your external Neon/Postgres credentials
#   3. Configure table names and filters
#   4. Reference in n8n workflow credentials

# ============================================
# Database Connection
# ============================================

# Full PostgreSQL connection string for external source
# Format: postgresql://<user>:<password>@<host>:<port>/<database>?sslmode=require
SOURCE_DB_URL="postgresql://user:password@host.region.neon.tech/dbname?sslmode=require"

# Alternative: individual connection parameters (if not using connection string)
SOURCE_DB_HOST=""
SOURCE_DB_PORT="5432"
SOURCE_DB_NAME=""
SOURCE_DB_USER=""
SOURCE_DB_PASSWORD=""
SOURCE_DB_SSL="require"

# ============================================
# Source Tables Configuration
# ============================================

# Company table to pull from
SOURCE_TABLE_COMPANY="company_invalid"

# People table to pull from
SOURCE_TABLE_PEOPLE="people_invalid"

# Optional: Additional entity tables
SOURCE_TABLE_CLIENT=""
SOURCE_TABLE_VENDOR=""
SOURCE_TABLE_CUSTOM=""

# ============================================
# Query Filters
# ============================================

# SQL WHERE clause to filter records for pulling
# Default: pull records not yet promoted to Enrichment Hub
SOURCE_FILTER="WHERE promoted_to IS NULL"

# Alternative filters (uncomment to use):
# SOURCE_FILTER="WHERE validation_status IN ('FAILED', 'PENDING')"
# SOURCE_FILTER="WHERE promoted_to IS NULL AND updated_at > NOW() - INTERVAL '7 days'"
# SOURCE_FILTER="WHERE needs_review = TRUE"

# ============================================
# Metadata Configuration
# ============================================

# Identifier for the source repository/system
# This will be stamped on all pulled records for traceability
SOURCE_REPO="external-neon-db"

# Optional: State code or region identifier
SOURCE_STATE_CODE=""

# Optional: Source environment (dev, staging, prod)
SOURCE_ENVIRONMENT="production"

# ============================================
# Sync Behavior
# ============================================

# Auto-update source records after successful transfer?
# If true, marks source rows with promoted_to='enrichment-hub'
AUTO_UPDATE_SOURCE="true"

# Column to update in source when AUTO_UPDATE_SOURCE=true
SOURCE_UPDATE_COLUMN="promoted_to"

# Value to set when marking as promoted
SOURCE_UPDATE_VALUE="enrichment-hub"

# Optional: Also update timestamp column
SOURCE_UPDATE_TIMESTAMP_COLUMN="promoted_at"

# ============================================
# Batch Processing
# ============================================

# Maximum records to pull per execution
BATCH_SIZE="1000"

# Enable pagination for large datasets
ENABLE_PAGINATION="true"

# ============================================
# Field Mapping (Optional)
# ============================================
# Map source fields to Enrichment Hub schema if different

# Company field mappings (leave empty if fields match exactly)
MAP_COMPANY_NAME=""
MAP_COMPANY_DOMAIN=""
MAP_COMPANY_INDUSTRY=""

# People field mappings
MAP_PEOPLE_FIRST_NAME=""
MAP_PEOPLE_LAST_NAME=""
MAP_PEOPLE_EMAIL=""

# ============================================
# Security & Compliance
# ============================================

# PII data included? (for audit logging)
CONTAINS_PII="true"

# Data classification level
DATA_CLASSIFICATION="confidential"

# GDPR region
GDPR_REGION="US"

# ============================================
# Example Configurations
# ============================================

# Example 1: Neon database with failed validations
# SOURCE_DB_URL="postgresql://user:pass@ep-example.us-east-2.aws.neon.tech/marketing?sslmode=require"
# SOURCE_TABLE_COMPANY="marketing.company_master"
# SOURCE_TABLE_PEOPLE="marketing.people_master"
# SOURCE_FILTER="WHERE validation_status = 'FAILED' AND promoted_to IS NULL"
# SOURCE_REPO="4.svg.marketing.main-db"
# AUTO_UPDATE_SOURCE="true"

# Example 2: External Postgres with pending enrichment
# SOURCE_DB_URL="postgresql://user:pass@external-db.example.com:5432/sales?sslmode=require"
# SOURCE_TABLE_COMPANY="public.companies_pending"
# SOURCE_TABLE_PEOPLE="public.contacts_pending"
# SOURCE_FILTER="WHERE enrichment_needed = true"
# SOURCE_REPO="external-sales-system"
# AUTO_UPDATE_SOURCE="false"

# ============================================
# Notes
# ============================================
# - All credentials should be kept secure and never committed to git
# - Use environment-specific .env files for dev/staging/prod
# - Test connection before scheduling automated pulls
# - Monitor batch sizes to avoid timeout issues
# - Ensure source database user has SELECT (and UPDATE if AUTO_UPDATE_SOURCE=true) permissions
