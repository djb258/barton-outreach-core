# ═══════════════════════════════════════════════════════════════════════════════
# COLUMN REGISTRY — Canonical Schema Spine
# ═══════════════════════════════════════════════════════════════════════════════
# Authority: imo-creator (Inherited)
# Status: ACTIVE — Barton Outreach Core
# Version: 1.0.0
# Purpose: Single source of truth for all table schemas in this hub
# ═══════════════════════════════════════════════════════════════════════════════
#
# RULES:
#   1. This file is the CANONICAL entry point for all data schema
#   2. Generated files (TypeScript types, Zod schemas) are PROJECTIONS of this file
#   3. Generated files are NEVER hand-edited
#   4. After updating this file, run: ./scripts/codegen-generate.sh
#   5. Pre-commit hook enforces sync between this file and generated output
#   6. Each table declares owning_subhub per ARCHITECTURE.md OWN-10
#   7. Each sub-hub has exactly 1 CANONICAL + 1 ERROR table (OWN-10a, OWN-10b)
#   8. Additional table types require ADR justification (OWN-10c)
#
# READING ORDER:
#   OSAM → column_registry.yml → generated files
#
# ═══════════════════════════════════════════════════════════════════════════════

version: "1.0.0"
last_updated: "2026-02-15"

# ═══════════════════════════════════════════════════════════════════════════════
# HUB IDENTITY
# ═══════════════════════════════════════════════════════════════════════════════

hub:
  hub_id: "04.04"
  hub_name: "Barton Outreach Core"
  universal_join_key: "outreach_id"
  universal_join_key_type: "UUID"

# ═══════════════════════════════════════════════════════════════════════════════
# SPINE TABLE
# ═══════════════════════════════════════════════════════════════════════════════

spine_table:
  schema: "outreach"
  name: "outreach"
  description: "Operational spine — all sub-hubs FK to outreach_id. Mints outreach_id, registers in CL."
  owning_subhub: null  # Spine is hub-level, not sub-hub-level
  leaf_type: "CANONICAL"
  source_of_truth: true
  row_identity_strategy: "UUID"
  columns:
    - name: "outreach_id"
      type: "UUID"
      nullable: false
      description: "Universal join key — minted here, propagated to all sub-hub tables"
      semantic_role: "identifier"
      format: "UUID"
    - name: "sovereign_company_id"
      type: "UUID"
      nullable: false
      description: "FK to cl.company_identity — links outreach record to sovereign identity"
      semantic_role: "foreign_key"
      format: "UUID"
    - name: "status"
      type: "TEXT"
      nullable: false
      description: "Workflow state of outreach lifecycle (INIT, ACTIVE, COMPLETED, ARCHIVED)"
      semantic_role: "attribute"
      format: "ENUM"
    - name: "created_at"
      type: "TIMESTAMPTZ"
      nullable: false
      description: "When the outreach record was created"
      semantic_role: "attribute"
      format: "ISO-8601"
    - name: "updated_at"
      type: "TIMESTAMPTZ"
      nullable: false
      description: "When the outreach record was last updated"
      semantic_role: "attribute"
      format: "ISO-8601"

# ═══════════════════════════════════════════════════════════════════════════════
# SUB-HUB TABLES
# ═══════════════════════════════════════════════════════════════════════════════

subhubs:

  # ─────────────────────────────────────────────────────────────────────────────
  # COMPANY TARGET (04.04.01)
  # ─────────────────────────────────────────────────────────────────────────────
  - subhub_id: "04.04.01"
    name: "company_target"
    tables:

      - schema: "outreach"
        name: "company_target"
        description: "Authoritative company list for outreach — 95,837 records. Source of company identity within outreach hub."
        leaf_type: "CANONICAL"
        source_of_truth: true
        row_identity_strategy: "UUID"
        columns:
          - name: "outreach_id"
            type: "UUID"
            nullable: false
            description: "FK to outreach.outreach spine table"
            semantic_role: "foreign_key"
            format: "UUID"
          - name: "company_unique_id"
            type: "TEXT"
            nullable: false
            description: "Barton company identifier (04.04.01.YY.NNNNNN format)"
            semantic_role: "identifier"
            format: "STRING"
          - name: "source"
            type: "TEXT"
            nullable: true
            description: "CL source system that originated this company record"
            semantic_role: "attribute"
            format: "STRING"

      - schema: "outreach"
        name: "company_target_errors"
        description: "Error tracking for company target sub-hub"
        leaf_type: "ERROR"
        source_of_truth: true
        row_identity_strategy: "UUID"
        columns:
          - name: "error_id"
            type: "UUID"
            nullable: false
            description: "Primary key for error record"
            semantic_role: "identifier"
            format: "UUID"
          - name: "outreach_id"
            type: "UUID"
            nullable: true
            description: "FK to spine (nullable — error may occur before entity exists)"
            semantic_role: "foreign_key"
            format: "UUID"
          - name: "error_type"
            type: "TEXT"
            nullable: false
            description: "Discriminator column — classifies the error"
            semantic_role: "attribute"
            format: "ENUM"
          - name: "error_message"
            type: "TEXT"
            nullable: false
            description: "Human-readable error description"
            semantic_role: "attribute"
            format: "STRING"
          - name: "created_at"
            type: "TIMESTAMPTZ"
            nullable: false
            description: "When the error was recorded"
            semantic_role: "attribute"
            format: "ISO-8601"

  # ─────────────────────────────────────────────────────────────────────────────
  # DOL FILINGS (04.04.03)
  # ─────────────────────────────────────────────────────────────────────────────
  - subhub_id: "04.04.03"
    name: "dol"
    tables:

      - schema: "outreach"
        name: "dol"
        description: "DOL bridge table — links outreach companies to DOL Form 5500 filings via EIN. 70,150 records."
        leaf_type: "CANONICAL"
        source_of_truth: true
        row_identity_strategy: "UUID"
        columns:
          - name: "outreach_id"
            type: "UUID"
            nullable: false
            description: "FK to outreach.outreach spine table"
            semantic_role: "foreign_key"
            format: "UUID"
          - name: "ein"
            type: "TEXT"
            nullable: false
            description: "Employer Identification Number (9-digit, no dashes)"
            semantic_role: "identifier"
            format: "STRING"
          - name: "filing_present"
            type: "BOOLEAN"
            nullable: true
            description: "Whether a Form 5500 filing exists for this EIN"
            semantic_role: "attribute"
            format: "BOOLEAN"
          - name: "funding_type"
            type: "TEXT"
            nullable: true
            description: "Benefit funding classification (pension_only, fully_insured, self_funded)"
            semantic_role: "attribute"
            format: "ENUM"
          - name: "renewal_month"
            type: "INTEGER"
            nullable: true
            description: "Plan year begin month (1-12)"
            semantic_role: "metric"
            format: "INTEGER"
          - name: "outreach_start_month"
            type: "INTEGER"
            nullable: true
            description: "5 months before renewal month (1-12) — when to begin outreach"
            semantic_role: "metric"
            format: "INTEGER"

      - schema: "outreach"
        name: "dol_errors"
        description: "Error tracking for DOL filings sub-hub"
        leaf_type: "ERROR"
        source_of_truth: true
        row_identity_strategy: "UUID"
        columns:
          - name: "error_id"
            type: "UUID"
            nullable: false
            description: "Primary key for error record"
            semantic_role: "identifier"
            format: "UUID"
          - name: "outreach_id"
            type: "UUID"
            nullable: true
            description: "FK to spine (nullable — error may occur before entity exists)"
            semantic_role: "foreign_key"
            format: "UUID"
          - name: "error_type"
            type: "TEXT"
            nullable: false
            description: "Discriminator column — classifies the DOL error"
            semantic_role: "attribute"
            format: "ENUM"
          - name: "error_message"
            type: "TEXT"
            nullable: false
            description: "Human-readable error description"
            semantic_role: "attribute"
            format: "STRING"
          - name: "created_at"
            type: "TIMESTAMPTZ"
            nullable: false
            description: "When the error was recorded"
            semantic_role: "attribute"
            format: "ISO-8601"

  # ─────────────────────────────────────────────────────────────────────────────
  # PEOPLE INTELLIGENCE (04.04.02)
  # ─────────────────────────────────────────────────────────────────────────────
  - subhub_id: "04.04.02"
    name: "people"
    tables:

      - schema: "people"
        name: "company_slot"
        description: "Executive position slots per company — 285,012 slots, 177,757 filled (62.4%). CANONICAL table for people sub-hub."
        leaf_type: "CANONICAL"
        source_of_truth: true
        row_identity_strategy: "UUID"
        columns:
          - name: "slot_id"
            type: "UUID"
            nullable: false
            description: "Primary key for the slot record"
            semantic_role: "identifier"
            format: "UUID"
          - name: "outreach_id"
            type: "UUID"
            nullable: false
            description: "FK to outreach.outreach spine table"
            semantic_role: "foreign_key"
            format: "UUID"
          - name: "slot_type"
            type: "TEXT"
            nullable: false
            description: "Executive role type (CEO, CFO, HR, CTO, CMO, COO)"
            semantic_role: "attribute"
            format: "ENUM"
          - name: "is_filled"
            type: "BOOLEAN"
            nullable: true
            description: "Whether this slot has an assigned person (TRUE = people record linked)"
            semantic_role: "attribute"
            format: "BOOLEAN"
          - name: "person_unique_id"
            type: "TEXT"
            nullable: true
            description: "FK to people.people_master.unique_id (Barton ID format 04.04.02.YY.NNNNNN.NNN)"
            semantic_role: "foreign_key"
            format: "STRING"

      - schema: "people"
        name: "people_master"
        description: "Contact and executive data — 182,946 records. SUPPORTING table (ADR-020) for people sub-hub."
        leaf_type: "SUPPORTING"
        source_of_truth: true
        row_identity_strategy: "COMPOSITE"
        columns:
          - name: "unique_id"
            type: "TEXT"
            nullable: false
            description: "Barton person identifier (04.04.02.YY.NNNNNN.NNN format, immutable)"
            semantic_role: "identifier"
            format: "STRING"
          - name: "first_name"
            type: "TEXT"
            nullable: false
            description: "Person first name from Hunter, Clay, or manual enrichment"
            semantic_role: "attribute"
            format: "STRING"
          - name: "last_name"
            type: "TEXT"
            nullable: false
            description: "Person last name from Hunter, Clay, or manual enrichment"
            semantic_role: "attribute"
            format: "STRING"
          - name: "email"
            type: "TEXT"
            nullable: true
            description: "Person email address"
            semantic_role: "attribute"
            format: "EMAIL"
          - name: "email_verified"
            type: "BOOLEAN"
            nullable: true
            description: "Whether email was checked via Million Verifier (TRUE = checked)"
            semantic_role: "attribute"
            format: "BOOLEAN"
          - name: "outreach_ready"
            type: "BOOLEAN"
            nullable: true
            description: "Whether email is safe to send outreach (TRUE = VALID verified)"
            semantic_role: "attribute"
            format: "BOOLEAN"
          - name: "linkedin_url"
            type: "TEXT"
            nullable: true
            description: "Person LinkedIn profile URL"
            semantic_role: "attribute"
            format: "STRING"

      - schema: "people"
        name: "people_errors"
        description: "Error tracking for people intelligence sub-hub"
        leaf_type: "ERROR"
        source_of_truth: true
        row_identity_strategy: "UUID"
        columns:
          - name: "error_id"
            type: "UUID"
            nullable: false
            description: "Primary key for error record"
            semantic_role: "identifier"
            format: "UUID"
          - name: "outreach_id"
            type: "UUID"
            nullable: true
            description: "FK to spine (nullable — error may occur before entity exists)"
            semantic_role: "foreign_key"
            format: "UUID"
          - name: "error_type"
            type: "TEXT"
            nullable: false
            description: "Discriminator column (validation, ambiguity, conflict, missing_data, stale_data, external_fail)"
            semantic_role: "attribute"
            format: "ENUM"
          - name: "error_stage"
            type: "TEXT"
            nullable: true
            description: "Pipeline stage where error occurred (slot_creation, slot_fill, etc.)"
            semantic_role: "attribute"
            format: "ENUM"
          - name: "error_message"
            type: "TEXT"
            nullable: false
            description: "Human-readable error description"
            semantic_role: "attribute"
            format: "STRING"
          - name: "retry_strategy"
            type: "TEXT"
            nullable: true
            description: "How to handle retry (manual_fix, auto_retry, discard)"
            semantic_role: "attribute"
            format: "ENUM"
          - name: "created_at"
            type: "TIMESTAMPTZ"
            nullable: false
            description: "When the error was recorded"
            semantic_role: "attribute"
            format: "ISO-8601"

  # ─────────────────────────────────────────────────────────────────────────────
  # BLOG CONTENT (04.04.05)
  # ─────────────────────────────────────────────────────────────────────────────
  - subhub_id: "04.04.05"
    name: "blog"
    tables:

      - schema: "outreach"
        name: "blog"
        description: "Blog content signals per outreach company — 95,004 records"
        leaf_type: "CANONICAL"
        source_of_truth: true
        row_identity_strategy: "UUID"
        columns:
          - name: "outreach_id"
            type: "UUID"
            nullable: false
            description: "FK to outreach.outreach spine table"
            semantic_role: "foreign_key"
            format: "UUID"

      - schema: "outreach"
        name: "blog_errors"
        description: "Error tracking for blog content sub-hub"
        leaf_type: "ERROR"
        source_of_truth: true
        row_identity_strategy: "UUID"
        columns:
          - name: "error_id"
            type: "UUID"
            nullable: false
            description: "Primary key for error record"
            semantic_role: "identifier"
            format: "UUID"
          - name: "outreach_id"
            type: "UUID"
            nullable: true
            description: "FK to spine (nullable — error may occur before entity exists)"
            semantic_role: "foreign_key"
            format: "UUID"
          - name: "error_type"
            type: "TEXT"
            nullable: false
            description: "Discriminator column — classifies the blog error (e.g., BLOG_MISSING)"
            semantic_role: "attribute"
            format: "ENUM"
          - name: "error_message"
            type: "TEXT"
            nullable: false
            description: "Human-readable error description"
            semantic_role: "attribute"
            format: "STRING"
          - name: "created_at"
            type: "TIMESTAMPTZ"
            nullable: false
            description: "When the error was recorded"
            semantic_role: "attribute"
            format: "ISO-8601"

  # ─────────────────────────────────────────────────────────────────────────────
  # BIT/CLS SCORING (04.04.04)
  # ─────────────────────────────────────────────────────────────────────────────
  - subhub_id: "04.04.04"
    name: "bit"
    tables:

      - schema: "outreach"
        name: "bit_scores"
        description: "CLS authorization scores per company — 13,226 records"
        leaf_type: "CANONICAL"
        source_of_truth: true
        row_identity_strategy: "UUID"
        columns:
          - name: "outreach_id"
            type: "UUID"
            nullable: false
            description: "FK to outreach.outreach spine table"
            semantic_role: "foreign_key"
            format: "UUID"

      - schema: "outreach"
        name: "bit_errors"
        description: "Error tracking for BIT/CLS scoring sub-hub"
        leaf_type: "ERROR"
        source_of_truth: true
        row_identity_strategy: "UUID"
        columns:
          - name: "error_id"
            type: "UUID"
            nullable: false
            description: "Primary key for error record"
            semantic_role: "identifier"
            format: "UUID"
          - name: "outreach_id"
            type: "UUID"
            nullable: true
            description: "FK to spine (nullable — error may occur before entity exists)"
            semantic_role: "foreign_key"
            format: "UUID"
          - name: "error_type"
            type: "TEXT"
            nullable: false
            description: "Discriminator column — classifies the scoring error"
            semantic_role: "attribute"
            format: "ENUM"
          - name: "error_message"
            type: "TEXT"
            nullable: false
            description: "Human-readable error description"
            semantic_role: "attribute"
            format: "STRING"
          - name: "created_at"
            type: "TIMESTAMPTZ"
            nullable: false
            description: "When the error was recorded"
            semantic_role: "attribute"
            format: "ISO-8601"

# ═══════════════════════════════════════════════════════════════════════════════
# GENERATED OUTPUT PATHS
# ═══════════════════════════════════════════════════════════════════════════════
# These paths are where codegen-generate.sh writes output.
# Files in these paths are PROJECTIONS — never hand-edit.
# ═══════════════════════════════════════════════════════════════════════════════

generated_output:
  hub_types: "src/data/hub/generated/"
  spoke_types: "src/data/spokes/generated/"
  data_dictionary: "docs/data/COLUMN_DATA_DICTIONARY.md"
  marker: "// AUTO-GENERATED FROM column_registry.yml — DO NOT EDIT"

# ═══════════════════════════════════════════════════════════════════════════════
# DOCUMENT CONTROL
# ═══════════════════════════════════════════════════════════════════════════════

document_control:
  created: "2026-02-15"
  last_modified: "2026-02-15"
  status: "ACTIVE"
  authority: "imo-creator (Inherited)"
  change_protocol: "Update registry → run codegen-generate.sh → commit both"
